

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. 重设root 密码 &mdash; Poppy 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="rscsa" href="readme.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Poppy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Poppy 介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_management/readme.html">用户管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_manage/readme.html">软件管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common_service/readme.html">系统常用服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/readme.html">安全管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/readme.html">数据库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/readme.html">存储</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor/readme.html">监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/readme.html">脚本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virtualization/readme.html">虚拟化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ha&amp;lb/readme.html">高可用 &amp; 负载均衡</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web/readme.html">web</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="readme.html">rscsa</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">1. 重设root 密码</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ip-dns">2. 配置主机名、IP地址/掩码/默认网关/DNS 地址</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ip">3. 修改ip地址</a></li>
<li class="toctree-l2"><a class="reference internal" href="#selinux">4. 确认 selinux 模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#yum">5. 配置yum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">6. 调整逻辑卷的大小</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">7. 创建用户和用户组</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">8. 文件权限设定</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">9. 建立计划任务</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">10. 文件特殊权限设定</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">11. 升级系统内核</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ldap">12. 配置ldap客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">13. 配置 LDAP 用户家目录自动挂载</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">14. 时间同步</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chronyd">15. 设置 chronyd 服务开机启动并重启服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">16. 打包文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">17. 创建用户</a></li>
<li class="toctree-l2"><a class="reference internal" href="#swap">18. 创建 swap 分区</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">19. 查找文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">20. 过滤文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lvm">21. LVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">22. 最后检查</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">23. 成绩自检：</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Poppy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="readme.html">rscsa</a> &raquo;</li>
        
      <li>1. 重设root 密码</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/rhcsa/rhcsa_7.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="root">
<h1>1. 重设root 密码<a class="headerlink" href="#root" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li>重启虚拟机 server，出现 GRUB 启动菜单时按 e 键进入编辑状态</li>
<li>找到 linux16 所在行，末尾添加 rd.break console=tty0，按 Ctrl+x 键进恢复模式</li>
<li>以可写方式挂载硬盘中的根目录，并重设root 密码：</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">-</span><span class="n">o</span> <span class="n">remount</span><span class="p">,</span><span class="n">rw</span> <span class="o">/</span><span class="n">sysroot</span> <span class="c1">#以可读写方式重新挂载根系</span>
<span class="n">chroot</span> <span class="o">/</span><span class="n">sysroot</span><span class="o">/</span> <span class="c1">#切换到根系统</span>
<span class="n">passwd</span> <span class="n">root</span> <span class="c1">#设置考试指定的root密码</span>
<span class="n">touch</span> <span class="o">/.</span><span class="n">autorelabel</span> <span class="c1">#标记下一次启动重做SELinux标签</span>
<span class="n">exit</span>
<span class="n">reboot</span>
</pre></div>
</div>
</div>
<div class="section" id="ip-dns">
<h1>2. 配置主机名、IP地址/掩码/默认网关/DNS 地址<a class="headerlink" href="#ip-dns" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostnamectl</span> <span class="nb">set</span><span class="o">-</span><span class="n">hostname</span> <span class="n">serverX</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div>
<div class="section" id="ip">
<h1>3. 修改ip地址<a class="headerlink" href="#ip" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># nmcli conn show</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># nmcli conn modify eth0 ipv4.addresses     &#39;172.25.0.11/24 172.25.0.254&#39; ipv4.dns 172.25.254.254   ipv4.method manual</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># nmcli connection modify eth0 connection.autoconnect yes</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># nmcli conn up eth0 [root@server0 ~]# nmcli conn show eth0</span>
</pre></div>
</div>
<p>ping 测试</p>
</div>
<div class="section" id="selinux">
<h1>4. 确认 selinux 模式<a class="headerlink" href="#selinux" title="Permalink to this headline">¶</a></h1>
<p>请按下列要求设定系统：</p>
<p>SeLinux 的工作模式为 enforcing 要求系统重启后依然生效</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1">#vim /etc/sysconfig/selinux</span>
<span class="c1"># SELINUX= can take one of these three values:</span>
<span class="n">SELINUX</span><span class="o">=</span><span class="n">enforcing</span> <span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># setenforce 1</span>
</pre></div>
</div>
</div>
<div class="section" id="yum">
<h1>5. 配置yum<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h1>
<p>YUM 的软件库源为 <a class="reference external" href="http://rhgls.domainX.example.com/pub/x86_64/Server">http://rhgls.domainX.example.com/pub/x86_64/Server</a>.将此配置为 您的系统的默认软件仓库</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpm</span> <span class="o">--</span><span class="kn">import</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">redhat</span><span class="o">-*</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cd /etc/yum.repos.d/</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="c1"># vim base.repo</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="c1"># cat base.repo</span>
<span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="n">name</span><span class="o">=</span><span class="n">base</span>
<span class="n">baseurl</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">classroom</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">rhel7</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">dvd</span> <span class="n">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="c1"># yum repolist</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h1>6. 调整逻辑卷的大小<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>请按照以下要求调整本地逻辑卷 lvm1 的容量：调整后的逻辑卷及文件系统大小为 770MiB 调整后确保文件系统中已存在的内容不能被破坏调整后的容量可能出现误差，只要在 730MiB - 805MiB 之间都是允许的调整后，保证其挂载目录不改变，文件系统完成</p>
<p>考试时候系统中只有一块硬盘 vda，而且已经使用三个分区 vda1 vda2 vda3。</p>
<p>如果卷组需要扩容，将剩余所有空间划分给第四个分区，第四个分区类型是扩展分区</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>lvm 信息
[root@server0 ~]# pvs
PV  VG      Fmt     Attr PSize      PFree
/dev/vdb1   vg1     lvm2 a--        508.00m 252.00m
[root@server0 ~]# vgs
VG  #PV #LV #SN Attr        VSize   VFree vg1       1       1       0 wz--n- 508.00m 252.00m
[root@server0 ~]# lvs
LV  VG      Attr    LSize   Pool Origin Data%       Move Log Cpy%Sync Convert
lvm1 vg1    -wi-ao---- 256.00m
当前卷组中没有足够的容量给 lvm1 扩容，需要扩卷组容量。原卷组有 508M，新建一个 500M 分区，加入到该卷组中。
[root@server0 ~]# fdisk /dev/vdb
Welcome to fdisk (util-linux 2.23.2).
Changes will remain in memory only, until you decide to write them. Be careful before using the write command.
Command (m for help): n
Partition type:
p   primary (1 primary, 0 extended, 3 free) e       extended
Select (default p):
Using default response p
Partition number (2-4, default 2):
First sector (1050624-20971519, default 1050624):
Using default value 1050624
Last sector, +sectors or +size{K,M,G} (1050624-20971519, default 20971519): +500M
Partition 2 of type Linux and of size 500 MiB is set
Command (m for help): t
Partition number (1-3, default 3): 2
Hex code (type L to list all codes): 8e
Changed type of partition &#39;Linux&#39; to &#39;Linux LVM&#39;
Command (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.
WARNING: Re-reading the partition table failed with error 16: Device or resource busy. The kernel still uses the old table. The new table will be used at the next reboot or after you run partprobe(8) or kpartx(8) Syncing disks.
[root@server0 ~]# partprobe
[root@server0 ~]# vgextend vg1 /dev/vdb2
Physical volume &quot;/dev/vdb2&quot; successfully created
Volume group &quot;vg1&quot; successfully extended
[root@server0 ~]# lvextend -r -L 770M /dev/vg1/lvm1
Rounding size to boundary between physical extents: 772.00 MiB
Extending logical volume lvm1 to 772.00 MiB
Logical volume lvm1 successfully resized meta-data=/dev/mapper/vg1-lvm1     isize=256       agcount=4, agsize=16384 blks
    =       sectsz=512      attr=2, projid32bit=1
    =       crc=0
data        =       bsize=4096      blocks=65536, imaxpct=25
    =       sunit=0 swidth=0 blks
naming      =version 2      bsize=4096      ascii-ci=0 ftype=0 log  =internal       bsize=4096      blocks=853, version=2
=   sectsz=512      sunit=0 blks, lazy-count=1 realtime =none       extsz=4096      blocks=0, rtextents=0
data blocks changed from 65536 to 197632
[root@server0 ~]#
验证：
[root@server0 ~]# df -h
Filesystem  Size    Used Avail Use% Mounted on
/dev/vda1 10G 3.1G 7.0G 31% / devtmpfs 906M 0 906M 0% /dev tmpfs 921M 140K 921M 1% /dev/shm tmpfs   921M    17M     904M    2% /run tmpfs   921M    0       921M    0% /sys/fs/cgroup
/dev/mapper/vg1-lvm1        769M    14M     756M    2% /vg1/lvm1
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h1>7. 创建用户和用户组<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h1>
<p>请按照以下要求创建用户、用户组：</p>
<ol class="arabic simple">
<li>新建一个名为 adminuser 的组，组 id 为 40000 新建一个名为 natasha 的用户，并将 adminuser 作为其附属组新建一个名为 harry 的用户，并将 adminuser 作为其附属组</li>
<li>新建一个名为 sarah 的用户，其不属于 adminuser 组，并将其 shell 设置为不可登陆 shell natasha、harry 和 sarah 三个用户的密码均设置为 glegunge</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># groupadd -g 40000 adminuser</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># useradd -G adminuser natasha</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># useradd -G adminuser harry</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># useradd -s /sbin/nologin sarah</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># echo glegunge |passwd --stdin natasha Changing password for user natasha. passwd: all authentication tokens updated successfully.</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># echo glegunge |passwd --stdin harry Changing password for user harry. passwd: all authentication tokens updated successfully.</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># echo glegunge |passwd --stdin sarah Changing password for user sarah.</span>
<span class="n">passwd</span><span class="p">:</span> <span class="nb">all</span> <span class="n">authentication</span> <span class="n">tokens</span> <span class="n">updated</span> <span class="n">successfully</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h1>8. 文件权限设定<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p>复制文件/etc/fstab 到/var/tmp 目录下，并按照以下要求配置/var/tmp/fstab 文件的权限:</p>
<p>该文件的所属人为 root</p>
<p>该文件的所属组为 root 该文件对任何人均没有执行权限用户 natasha 对该文件有读和写的权限用户 harry 对该文件既不能读也不能写所有其他用户（包括当前已有用户及未来创建的用户）对该文件都有读的权限解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# cp /etc/fstab /var/tmp/
[root@server0 ~]# cd /var/tmp/
[root@server0 tmp]# ll fstab
-rw-r--r--. 1 root root 358 Apr     4 07:27 fstab
[root@server0 tmp]# setfacl -m u:natasha:rw fstab
[root@server0 tmp]# setfacl -m u:harry:- fstab
[root@server0 tmp]# setfacl -m o:r fstab
验证结果：
[root@server0 ~]# getfacl /var/tmp/fstab
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h1>9. 建立计划任务<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h1>
<p>对 natasha 用户建立计划任务，要求在本地时间的每天 14：23 执行以下命令：/bin/echo
“rhcsa”</p>
<p>解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# su - natasha
[natasha@server0 ~]$ crontab -e 编辑临时文件插入如下条目：
23 14 * * * /bin/echo &quot;rhcsa&quot;
:wq 保存退出。
查看结果
[natasha@server0 ~]$ crontab -l
23 14 * * * /bin/echo &quot;rhcsa&quot;
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h1>10. 文件特殊权限设定<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h1>
<p>在/home 目录下创建名为 admins 的子目录，并按以下要求设置权限：
#. /home/admins 的所属组为 adminuser
#. 该目录对 adminuser 组的成员可读可执行可写，但对其他用户没有任何权限，但 root 不受限制
#. 在/home/admins 目录下所创建的文件的所属组自动被设置为 adminuser</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># mkdir /home/admins</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># chgrp adminuser /home/admins</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># chmod 2770 /home/admins</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h1>11. 升级系统内核<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h1>
<p>请按下列要求更新系统的内核：</p>
<p>新内核的 RPM 包位于
<a class="reference external" href="http://content.example.com/rhel7.0/x86_64/errata/Packages/">http://content.example.com/rhel7.0/x86_64/errata/Packages/</a></p>
<p>系统重启后，默认以新内核启动系统，原始的内核将继续可用</p>
<p>在 foundation 上使用浏览 <a class="reference external" href="http://content.example.com/rhel7.0/x86_64/errata/Packages/">http://content.example.com/rhel7.0/x86_64/errata/Packages/</a>, 找到文件，复制下载链接</p>
<p>在终端中使用 wget 下载文件。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># wget http://content.example.com/rhel7.0/x86_64/errata/Packages/kernel-3.10.0-123.1.2.el7.x86_64.rpm</span>
</pre></div>
</div>
<p>安装 kernel：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">localinstall</span> <span class="o">-</span><span class="n">y</span> <span class="n">kernel</span><span class="o">-</span><span class="mf">3.10</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">123.1</span><span class="o">.</span><span class="mf">2.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span> <span class="c1">#安装内核时间比较长，需要等待几分钟。</span>
</pre></div>
</div>
<p>验证：查看当前内核版本信息，重启后再查看内核版本信息。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># uname -r</span>
<span class="mf">3.10</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">123.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span>
</pre></div>
</div>
</div>
<div class="section" id="ldap">
<h1>12. 配置ldap客户端<a class="headerlink" href="#ldap" title="Permalink to this headline">¶</a></h1>
<p>在 classroom.example.com 上已经部署了一台 LDAP 认证服务器，按以下要求将你的系统加入到该 LDAP 服务中，并使用 ldap 认证用户密码：</p>
<p>该 LDAP 认证服务的 Base DN 为：dc=example,dc=com 该 LDAP 认证服务的 LDAP Server 为：classroom.example.com</p>
<p>认证的会话连接需要使用 TLS 加密，加密所用证书请在此下载 <a class="reference external" href="http://classroom.example.com/pub/example-ca.crt">http://classroom.example.com/pub/example-ca.crt</a></p>
<p>上一次考试只给了 Base DN 和 ldap 服务器，ldap 服务器名填写题目中提到的主机名。</p>
<p>解答：</p>
<p>用户信息和验证信息全为 ldap</p>
<p>安装软件包</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># yum install -y sssd</span>
</pre></div>
</div>
<p>打开配置界面</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># authconfig-tui</span>
</pre></div>
</div>
<p>左侧选中 Use LDAP 和右侧选中 Use LDAP Authentication，然后 Next</p>
<p>选中 Use TLS 和填写 LDAP Server 和 Base DN，然后 Next</p>
<p>下载证书</p>
<p>将证书下载到目录/etc/openldap/cacerts/</p>
<p>新开一个终端下载证书</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cd /etc/openldap/cacerts/</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="n">cacerts</span><span class="p">]</span><span class="c1"># wget http://classroom.example.com/pub/example-ca.crt</span>
</pre></div>
</div>
<p>下载完成后，回来点击 Ok。如果在证书下载前按了 ok，那么需要将前面的配置恢复成默认，然后重新配置。用户信息为 ldap 和验证信息为 Kerberos</p>
<p>安装软件包</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">sssd</span> <span class="n">krb5</span><span class="o">-</span><span class="n">workstation</span><span class="o">.</span><span class="n">x86_64</span>
</pre></div>
</div>
<p>打开配置界面</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authconfig</span><span class="o">-</span><span class="n">tui</span>
</pre></div>
</div>
<p>选中 Use LDAP 和 Use Kerberos，然后 Next</p>
<p>选中 Use TLS 和填写 LDAP Server 和 Base DN，然后 Next</p>
<p>配置 Kerberos</p>
<p>下载证书
将证书下载到目录/etc/openldap/cacerts/</p>
<p>新开一个终端下载证书</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cd /etc/openldap/cacerts/</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="n">cacerts</span><span class="p">]</span><span class="c1"># wget http://classroom.example.com/pub/example-ca.crt</span>
</pre></div>
</div>
<p>下载完成后，回来点击 Ok。如果在证书下载前按了 ok，那么需要将前面的配置恢复成默认，然后重新配置。验证：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># getent passwd ldapuser0</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h1>13. 配置 LDAP 用户家目录自动挂载<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h1>
<p>请使用 LDAP 服务器上的用户 ldapuser0 登陆系统，并满足以下要求：</p>
<ol class="arabic simple">
<li>ldapuser0 用户的家目录路径为/home/guests/ldapuser0</li>
<li>ldapuser0 用户登陆后，家目录会自动挂载到 classroom.example.com 服务通过 nfs 服务到处的/home/guests/ldapuser0</li>
<li>客户端挂载使用 nfs 版本 3</li>
</ol>
<p>解答：</p>
<p>安装软件包：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># yum install -y autofs</span>
</pre></div>
</div>
<p>查看 ldapuser0 家目录位置为/home/guests/ldapuser0 和服务器共享的位置/home/guests</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# getent passwd ldapuser0
ldapuser0:*:1700:1700:LDAPTest User 0:/home/guests/ldapuser0:/bin/bash
[root@server0 ~]# showmount -e classroom Export list for classroom:
/home/guests 172.25.0.0/255.255.0.0
准备目录
[root@server0 ~]# mkdir /home/guests
[root@server0 ~]# cd /etc/auto.master.d/
[root@server0 auto.master.d]# touch ldap.autofs
[root@server0 auto.master.d]# vim ldap.autofs
/home/guests        /etc/auto.ldap
:wq 保存退出
[root@server0 auto.master.d]# cd /etc
[root@server0 etc]# touch auto.ldap
[root@server0 etc]# vim auto.ldap
*   -rw,sync,v3     classroom.example.com:/home/guests/&amp;
:wq 保存退出
设置 autofs 开机启动，并启动 autofs 服务。
[root@server0 ~]# systemctl enable autofs.service
ln  -s      &#39;/usr/lib/systemd/system/autofs.service&#39; &#39;/etc/systemd/system/multi-user.target.wants/autofs.service&#39;
[root@server0 ~]# systemctl restart autofs.service
验证：
su - ldapuser0
</pre></div>
</div>
<p>本题如果自动挂载失败，可能是时间与服务器不一致到值得。可以先做 NTP 服务配置，再回来完成此题。如果还是不行，使用 date 命令手动设置时间。</p>
<p>先查看物理主机时间</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span>
</pre></div>
</div>
<p>然后设置 server 时间，将物理主机完整时间拷贝过来，修改一下操作过程时间差。</p>
<blockquote>
<div>[<a class="reference external" href="mailto:root&#37;&#52;&#48;server0">root<span>&#64;</span>server0</a> ~]# date -s “Wed Mar 15 09:37:36 CST 2017”</div></blockquote>
</div>
<div class="section" id="id8">
<h1>14. 时间同步<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>使用 NTP 配置系统时间与服务器 classroom.example.com 同步，要求系统重启后依然生效。</p>
<p>解答：</p>
<p>使用 chrony 配置或者 ntp 配置，都可以得分。</p>
<p>确认 chrony 软件包已经安装</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="nb">list</span> <span class="n">chrony</span>
</pre></div>
</div>
<p>一般情况，系统会自动安装。如果没有安装执行 yum install -y chrony 安装。</p>
<p>编辑配置文件/etc/chrony.conf，将文件中 server 记录全部删除或者注释掉，添加如下内容：
server classroom.example.com iburst</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# vim /etc/chrony.conf
server classroom.example.com iburst
:wq 保存退出。
</pre></div>
</div>
</div>
<div class="section" id="chronyd">
<h1>15. 设置 chronyd 服务开机启动并重启服务<a class="headerlink" href="#chronyd" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl enable chronyd</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl restart chronyd</span>
</pre></div>
</div>
<p>验证：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># chronyc sources -v</span>
</pre></div>
</div>
<p>利用 server 设定上层 NTP 服务器，格式如下：</p>
<p>server [IP or hostname] [prefer] perfer:表示优先级最高 burst ：当一个运程 NTP 服务器可用时，向它发送一系列的并发包进行检测。 iburst ：当一个运程 NTP 服务器不可用时，向它发送一系列的并发包进行检测。</p>
<p>ntp 和 chrony 服务有冲突，同时只能运行一个。我们的评分脚本是根据 chrony 评分的。</p>
</div>
<div class="section" id="id9">
<h1>16. 打包文件<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<p>请对 /etc/sysconfig 目录进行打包并用 gzip 压缩，生成的文件保存为/root/sysconfig.tar.gz</p>
<p>-j, –bzip2 filter the archive through bzip2</p>
<p>-J, –xz filter the archive through xz</p>
<p>-z, –gzip filter the archive through gzip</p>
<p>解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># tar -cvzf     /root/sysconfig.tar.gz /etc/sysconfig 评分脚本按照 bz2 格式评分，/root/sysconfig.tar.bz2</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h1>17. 创建用户<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h1>
<p>请创建一个名为 alex 的用户，并满足以下要求：</p>
<p>用户 id 为 3456 密码为 glegunge</p>
<p>解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># useradd -u 3456 alex</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># echo glegunge|passwd --stdin alex</span>
</pre></div>
</div>
</div>
<div class="section" id="swap">
<h1>18. 创建 swap 分区<a class="headerlink" href="#swap" title="Permalink to this headline">¶</a></h1>
<p>为系统新增加一个 swap 分区：新建的 swap 分区容量为 512MiB 重启系统后，新建的 swap 分区会自动激活不能删除或者修改原有的 swap 分区</p>
<p>解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# fdisk /dev/vdb
Welcome to fdisk (util-linux 2.23.2).
Changes will remain in memory only, until you decide to write them. Be careful before using the write command.
Command (m for help): n
Partition type:
p   primary (2 primary, 0 extended, 2 free) e       extended
Select (default p):
Using default response p
Partition number (3,4, default 3):
First sector (2074624-20971519, default 2074624):
Using default value 2074624
Last sector, +sectors or +size{K,M,G} (2074624-20971519, default 20971519): +512M
Partition 3 of type Linux and of size 512 MiB is set
Command (m for help): t
Partition number (1-3, default 3):
Hex code (type L to list all codes): 82
Changed type of partition &#39;Linux&#39; to &#39;Linux swap / Solaris&#39;
Command (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.
WARNING: Re-reading the partition table failed with error 16: Device or resource busy. The kernel still uses the old table. The new table will be used at the next reboot or after you run partprobe(8) or kpartx(8) Syncing disks.
通知内核更新分区表
[root@server0 ~]# partprobe
格式化 swap 分区
[root@server0 ~]# mkswap /dev/vdb3
编辑/etc/fstab
[root@server0 ~]# vim /etc/fstab
UUID=3a433201-5c45-46e0-9c1f-b8f2e48de8eb   swap    swap    defaults
0 0
:wq 保存退出。
挂载
[root@server0 ~]# swapon /dev/vdb3
验证：
[root@server0 ~]# swapon -s
[root@server0 ~]# free
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h1>19. 查找文件<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h1>
<p>请把系统上拥有者为 ira 用户的所有文件，并将其拷贝到/root/findfiles 目录中</p>
<p>解答：文件夹一定要先创建。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># mkdir findfiles</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># find / -user ira -exec cp -rpf {} /root/findfiles/ \;</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h1>20. 过滤文件<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h1>
<p>把/usr/share/dict/words 文件中所有包含 seismic 字符串的行找到，并将这些行按照原始文件中的顺序存放到/root/wordlist 中，/root/wordlist 文件不能包含空行</p>
<p>解答：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@server0</span> <span class="o">~</span><span class="p">]</span><span class="c1"># grep seismic /usr/share/dict/words &gt; /root/wordlist</span>
</pre></div>
</div>
</div>
<div class="section" id="lvm">
<h1>21. LVM<a class="headerlink" href="#lvm" title="Permalink to this headline">¶</a></h1>
<p>请按下列要求创建一个新的逻辑卷创建一个名为 exam 的卷组，卷组的 PE 尺寸为 16MiB 逻辑卷的名字为 lvm2,所属卷组为 exam,该逻辑卷由 8 个 PE 组成将新建的逻辑卷格式化为 xfs 文件系统，要求系统启动时，该逻辑卷能被自动挂载到
/exam/lvm2 目录
解答：准备分区，标记分区类型，通知内核更新分区表</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@server0 ~]# fdisk /dev/vdb
Welcome to fdisk (util-linux 2.23.2).
Changes will remain in memory only, until you decide to write them. Be careful before using the write command.
Command (m for help): n
Partition type:
p   primary (3 primary, 0 extended, 1 free) e       extended
Select (default e):
Using default response e
Selected partition 4
First sector (3123200-20971519, default 3123200):
Using default value 3123200
Last sector, +sectors or +size{K,M,G} (3123200-20971519, default 20971519):
Using default value 20971519
Partition 4 of type Extended and of size 8.5 GiB is set
Command (m for help): n
All primary partitions are in use
Adding logical partition 5
First sector (3125248-20971519, default 3125248):
Using default value 3125248
Last sector, +sectors or +size{K,M,G} (3125248-20971519, default 20971519): +500M
Partition 5 of type Linux and of size 500 MiB is set
Command (m for help): t
Partition number (1-5, default 5):
Hex code (type L to list all codes): 8e
Changed type of partition &#39;Linux&#39; to &#39;Linux LVM&#39;
Command (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.
WARNING: Re-reading the partition table failed with error 16: Device or resource busy. The kernel still uses the old table. The new table will be used at the next reboot or after you run partprobe(8) or kpartx(8) Syncing disks.
[root@server0 ~]# partprobe
创建 pv，vg，lv
[root@server0 ~]# pvcreate /dev/vdb5
Physical volume &quot;/dev/vdb3&quot; successfully created
[root@server0 ~]# vgcreate -s 16M exam /dev/vdb5 Volume group &quot;wgroup&quot; successfully created
[root@server0 ~]# lvcreate -l 8 -n lvm2 exam
Logical volume &quot;wshare&quot; created
[root@server0 ~]#
格式化分区
[root@server0 ~]# mkfs.xfs  /dev/exam/lvm2
创建挂载点
[root@server0 ~]# mkdir /exam/lvm2
设置永久挂载，编辑/etc/fstab，添加如下内容：
[root@server0 ~]# vim /etc/fstab
/dev/exam/lvm2      /exam/lvm2      xfs     defaults        0 0
:wq 保存退出
验证：
[root@server0 ~]# mount -a
[root@server0 ~]# df -h
[root@server0 ~]# vgdisplay exam
[root@server0 ~]# lvdisplay /dev/exam/lvm2
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h1>22. 最后检查<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h1>
<p>重启前检查一遍考试涉及到的服务是否设置开机启动，selinux 问题服务包涵：定时计划任务 crond，ntp 对时 chronyd，自动挂载 autofs</p>
<p>第一遍做完一定要重启，保证有充足的时间排错。不要到最后 5 分钟再重启系统。</p>
<p>扩文件系统分两步：扩逻辑卷和扩文件系统，也可以在 lvextend 时候使用-r 参数直接扩文件系统，ext4 和 xfs 都支持</p>
<p>ldap 题目使用 authconfig-tui 字符界面完成。</p>
</div>
<div class="section" id="id14">
<h1>23. 成绩自检：<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h1>
<p>server0： lab examrhcsa grade</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="readme.html" class="btn btn-neutral" title="rscsa" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Alvin Wan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>